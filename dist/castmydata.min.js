!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.CastMyData=t.CastMyData||{})}(this,function(t){"use strict";var e=function(){function t(t){this.head=new e,this.tail=new e(this.head),this.head.next=this.tail,this.linkConstructor=t,this.reg={}}function e(t,e,i){this.prev=t,this.next=e,this.fn=i||o}function o(){}function i(){this._events={}}var n=0;return t.prototype={insert:function(t){var o=new e(this.tail.prev,this.tail,t);return o.next.prev=o.prev.next=o,o},remove:function(t){t.prev.next=t.next,t.next.prev=t.prev}},e.prototype.run=function(t){this.fn(t),this.next&&this.next.run(t)},i.prototype={on:function(e,o){var i=this;e.split(/\W+/g).forEach(function(e){var s=i._events[e]||(i._events[e]=new t),r=o._eev||(o._eev=++n);s.reg[r]||(s.reg[r]=s.insert(o))})},off:function(t,e){var o=this;t.split(/\W+/g).forEach(function(t){var i=o._events[t],n=i.reg[e._eev];i.reg[e._eev]=void 0,i&&n&&i.remove(n)})},emit:function(t,e){var o=this._events[t];o&&o.head.run(e)}},i}(),o=function(t,e){for(var o in t)t.hasOwnProperty(o)&&e(t[o],o)},i=function(t,e){var e=e||{},i=this;o(e,function(t,e){i[e]=t}),this._events={},this._endpoint=t};i.prototype=Object.create(e.prototype),i.prototype["delete"]=function(){this._endpoint["delete"](this.id)},i.prototype.put=function(t){var t=t||{},e=this;o(t,function(t,o){e[o]=t}),this._endpoint.put(this.id,t)};var n=function(t,e){var n="undefined"!=typeof io?io:require("socket.io-client"),s=this._socket=n(t,{multiplex:!1}),r=this.models=[],p=this;this._events={},s.path=e,s.on("records",function(t){r.splice(0,r.length);t.forEach(function(t){t=new i(p,t),t.emit("post",t),r.push(t)});p.emit("records",r)}),s.on("post",function(t){var e=new i(p,t.payload);r.push(e),p.emit("post",e)}),s.on("put",function(t){var e=r.filter(function(e){return e.id==t.id}).pop();e&&(o(t.payload,function(t,o){e[o]=t}),e.emit("put",t.payload),p.emit("put",e,t.payload))}),s.on("delete",function(t){var e=r.filter(function(e){return e.id==t.id}).pop(),o=r.indexOf(e);e&&(r.splice(o,1),e.emit("delete"),p.emit("delete",e))}),s.on("broadcast",function(t){p.emit("broadcast",t.payload)})};n.prototype=Object.create(e.prototype),n.prototype.subscribe=function(t){var t=t||{};this._socket.options=t,this._socket.emit("join",{path:this._socket.path,options:t})},n.prototype.unsubscribe=function(){this._socket.emit("leave",{path:this._socket.path})},n.prototype.all=function(t){return this._socket.emit("all",this._socket.path),this},n.prototype.find=function(t){return this.models.filter(function(e){return e.id==t}).pop()},n.prototype.post=function(t){return this._socket.emit("post",{path:this._socket.path,payload:t}),this},n.prototype.put=function(t,e){return this._socket.emit("put",{path:this._socket.path,payload:e,id:t}),this},n.prototype["delete"]=function(t){return this._socket.emit("delete",{path:this._socket.path,id:t}),this},n.prototype.broadcast=function(t){return this._socket.emit("broadcast",{path:this._socket.path,payload:t}),this},n.prototype.close=function(){this._socket.close()},t.Model=i,t.Endpoint=n});