!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.CastMyData=t.CastMyData||{})}(this,function(t){"use strict";var e=function(){function t(t){this.head=new e,this.tail=new e(this.head),this.head.next=this.tail,this.linkConstructor=t,this.reg={}}function e(t,e,n){this.prev=t,this.next=e,this.fn=n||i}function i(){}function n(){this._events={}}var o=0;return t.prototype={insert:function(t){var i=new e(this.tail.prev,this.tail,t);return i.next.prev=i.prev.next=i,i},remove:function(t){t.prev.next=t.next,t.next.prev=t.prev}},e.prototype.run=function(t){this.fn(t),this.next&&this.next.run(t)},n.prototype={on:function(e,i){var n=this;return e.split(/\W+/g).forEach(function(e){var s=n._events[e]||(n._events[e]=new t),r=i._eev||(i._eev=++o);s.reg[r]||(s.reg[r]=s.insert(i))}),this},off:function(t,e){var i=this;return t.split(/\W+/g).forEach(function(t){var n=i._events[t],o=n.reg[e._eev];n.reg[e._eev]=void 0,n&&o&&n.remove(o)}),this},emit:function(t,e){var i=this._events[t];return i&&i.head.run(e),this}},n}(),i=function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)},n=function(t,e){var e=e||{},n=this;i(e,function(t,e){n[e]=t}),this._events={},this._endpoint=t};n.prototype=Object.create(e.prototype),n.prototype["delete"]=function(){this._endpoint["delete"](this.id)},n.prototype.put=function(t){var t=t||{},e=this;i(t,function(t,i){e[i]=t}),this._endpoint.put(this.id,t)};var o=function(t,e){var o="undefined"!=typeof io?io:require("socket.io-client"),s=this._socket=o(t,{multiplex:!1}),r=this.models=[],p=this;this._events={},s.path=e,s.on("records",function(t){r.splice(0,r.length);t.forEach(function(t){t=new n(p,t),t.emit("post",t),r.push(t)});p.emit("records",r)}),s.on("post",function(t){var e=new n(p,t.payload);r.push(e),p.emit("post",e)}),s.on("put",function(t){var e=r.filter(function(e){return e.id==t.id}).pop();e&&(i(t.payload,function(t,i){e[i]=t}),e.emit("put",t.payload),p.emit("put",e,t.payload))}),s.on("delete",function(t){var e=r.filter(function(e){return e.id==t.id}).pop(),i=r.indexOf(e);e&&(r.splice(i,1),e.emit("delete"),p.emit("delete",e))}),s.on("broadcast",function(t){p.emit("broadcast",t.payload)})};o.prototype=Object.create(e.prototype),o.prototype.subscribe=function(t){var t=t||{};return this._socket.options=t,this._socket.emit("join",{path:this._socket.path,options:t}),this},o.prototype.unsubscribe=function(){return this._socket.emit("leave",{path:this._socket.path}),this},o.prototype.all=function(t){return this._socket.emit("all",this._socket.path),this},o.prototype.find=function(t){return this.models.filter(function(e){return e.id==t}).pop()},o.prototype.post=function(t){return this._socket.emit("post",{path:this._socket.path,payload:t}),this},o.prototype.put=function(t,e){return this._socket.emit("put",{path:this._socket.path,payload:e,id:t}),this},o.prototype["delete"]=function(t){return this._socket.emit("delete",{path:this._socket.path,id:t}),this},o.prototype.broadcast=function(t){return this._socket.emit("broadcast",{path:this._socket.path,payload:t}),this},o.prototype.close=function(){return this._socket.close(),this},t.Model=n,t.Endpoint=o});