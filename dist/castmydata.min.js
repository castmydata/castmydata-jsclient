!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.CastMyData=t()}}(function(){return function t(e,n,i){function o(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(r)return r(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return o(n?n:t)},p,p.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){},{}],2:[function(t,e,n){!function(){"use strict";function n(t){var e={};for(var n in t)t.hasOwnProperty(n)&&-1==["$$hashKey","_endpoint","_events"].indexOf(n)&&(e[n]=t[n]);return e}function i(t,e){e=e||{},o.deepExtend(this,e),this.id=this.id||o.uuid(),this.meta=this.meta||{},this._events={},this._endpoint=t}var o=t("../utils");i.prototype=Object.create(o.Eev.prototype),i.prototype.get=function(){return n(this)},i.prototype.post=function(t){var e=this;t&&this._endpoint._socket.once("receipt:post",t);var n={meta:{synced:!1,createdAt:Date.now(),updatedAt:Date.now(),deletedAt:null}};return o.deepExtend(this,n),this._endpoint.models.push(this),this._endpoint.commit(),this.emit("post",this),this._endpoint.emit("post",this),this._endpoint._socket.once("denied:post:"+this.id,function(){e._endpoint._socket.off("receipt:post",t);var n=e._endpoint.models.indexOf(e);n>-1&&(e._endpoint.models.splice(n,1),e._endpoint.commit(),e._endpoint.emit("post",e.id))}),this._endpoint._socket.emit("post",this.get()),this},i.prototype.put=function(t,e){var n=this;return e&&this._endpoint._socket.once("receipt:put",e),o.deepExtend(this,t),this.meta.synced=!1,this.meta.updatedAt=Date.now(),this._endpoint.commit(),this.emit("put",this,t),this._endpoint.emit("put",this,t),this._endpoint._socket.once("denied:put:"+this.id,function(t){n._endpoint._socket.off("receipt:put",e),o.deepExtend(n,t),n._endpoint.commit(),n.emit("put"),n._endpoint.emit("put")}),this._endpoint._socket.emit("put",this.get()),this},i.prototype["delete"]=function(t){var e=this;t&&this._endpoint._socket.once("receipt:delete",t);for(var n in this)this.hasOwnProperty(n)&&-1==["meta","id","_endpoint","_events"].indexOf(n)&&delete this[n];return this.meta.deletedAt=Date.now(),this.meta.synced=!1,this._endpoint.commit(),this.emit("delete",this),this._endpoint.emit("delete",this),this._endpoint._socket.once("denied:delete:"+this.id,function(n){e._endpoint._socket.off("receipt:delete",t),o.deepExtend(e,n),e._endpoint.commit(),e.emit("delete"),e._endpoint.emit("delete")}),this._endpoint._socket.emit("delete",this.id),this},i.prototype.merge=function(t){return JSON.stringify(n(this))!=JSON.stringify(t)&&(o.deepExtend(this,t),this._endpoint.commit(),this.emit("merge",this),this._endpoint.emit("merge",this)),this},e.exports=i}(this)},{"../utils":13}],3:[function(t,e,n){!function(){"use strict";function n(t,e){this.models=[],this._filter=e,this._endpoint=t,this._events={};var n=this;this._endpoint.on("subscribed",function(){n.run(),n.emit("subscribed")}),this._endpoint.on("unsubscribed",function(){n.run(),n.emit("unsubscribed")}),this._endpoint.on("sync",function(t){n.run(),n.emit("sync",t)}),this._endpoint.on("post",function(t){n.run(),n.emit("post",t)}),this._endpoint.on("put",function(t){n.run(),n.emit("put",t)}),this._endpoint.on("delete",function(t){n.run(),n.emit("put",t)}),this._endpoint.on("clear",function(){n.run(),n.emit("clear")}),this._endpoint.on("merge",function(){n.run(),n.emit("merge")}),this.run.call(n)}var i=t("../utils");n.prototype=Object.create(i.Eev.prototype),n.prototype.run=function(){return this.models=i.sift(this._filter,this._endpoint.models),this},n.prototype.put=function(t){return this.models.forEach(function(e){e.put(t)}),this},n.prototype["delete"]=function(){return this.models.forEach(function(t){t["delete"]()}),this},e.exports=n}(this)},{"../utils":13}],4:[function(t,e,n){!function(){"use strict";function n(e,n,s){function c(t,e){y._subscribed&&(t.forEach(function(t){f(t)}),y.emit("sync",y.models),e&&e())}function f(t,e){if(y._subscribed){var n=y.find(t.id);n?(n.merge(t),n.emit("merge",n),y.emit("merge",n)):(n=new y._Model(y,t),y.models.push(n),y.commit()),n.emit("post",n),y.emit("post",n),e&&e(n)}}function p(t,e){if(y._subscribed){var n=y.find(t.id);n?(i.deepExtend(n,t),y.commit(),n.emit("merge",n),y.emit("merge",n)):(n=new y._Model(y,t),y.models.push(n),y.commit()),n.emit("put"),e&&e(n)}}function d(t,e){if(y._subscribed){var n=y.find(t.id);if(n){for(var o in n)n.hasOwnProperty(o)&&-1==["id","meta","$$hashKey","_endpoint","_events"].indexOf(o)&&delete n[o];i.deepExtend(n.meta,t.meta),y.commit(),n.emit("merge",n),y.emit("merge",n),e&&e(n)}}}function a(t){t=t||function(){},y._storage.clear(function(t){return t?i.handleError(t):(y.models.splice(0,y.models.length),void y.emit("clear"))})}function h(t,e){y.emit("listen",t),e&&e(t)}function l(t,e){y.emit("unlisten",t),e&&e(t)}function m(t,e){y.emit("broadcast",t),y.emit("broadcast:"+t.channel,t.payload),e&&e(t)}function _(){y._subscribed&&y.subscribe(y._options)}function v(t){console.error(t)}s=s||{};var y=this;if(/[^a-zA-Z0-9-_\.]/g.test(n))throw"Invalid characters in path. Allowed characters are a-z, A-Z, 0-9, -, _, .";u||(u=t("socket.io-client"));var g=u(e+"?path="+n,{multiplex:!1});this._options={storage:"jjlc"},i.deepExtend(this._options,s),this._socket=g,this._Model=this._options.model||r,this.models=[],this._events={},this._filter={},this._subscribed=!1,this._storage=new o("cmd_"+n,{driver:this._options.storage}),g.path=n,g.on("sync",c),g.on("post",f),g.on("put",p),g.on("delete",d),g.on("clear",a),g.on("broadcast",m),g.on("reconnect",_),g.on("cmderror",v),g.on("sync",function(t){c(t,function(t){y.emit("receipt:sync")})}),g.on("receipt:post",function(t){f(t,function(t){t.emit("receipt:post",t)})}),g.on("receipt:put",function(t){p(t,function(t){t.emit("receipt:put",t)})}),g.on("receipt:delete",function(t){d(t,function(t){t.emit("receipt:delete",t)})}),g.on("receipt:clear",function(){a(function(){y.emit("receipt:clear")})}),g.on("receipt:listen",function(t){h(t,function(t){y.emit("receipt:listen:"+t,t)})}),g.on("receipt:unlisten",function(t){l(t,function(t){y.emit("receipt:unlisten:"+t,t)})}),g.on("receipt:broadcast",function(t){m(t,function(t){y.emit("receipt:broadcast",t)})})}var i=t("../utils"),o=t("../storage"),r=t("../modules/Model"),s=t("../modules/Query"),u="undefined"!=typeof window?window.io:null;n.prototype=Object.create(i.Eev.prototype),n.prototype.load=function(t){t=t||function(){};var e=this;this._storage.get(function(n,o){var r=o.map(function(t){return new e._Model(e,t)});e._filter&&(r=i.sift(e._filter,r)),e.models.splice(0,e.models.length),e.emit("load",e.models),t()})},n.prototype.commit=function(t){var e=this;t=t||function(){};var n=this.models.map(function(t){return t.get()});this._storage.set(n,function(t){return t?i.handleError(t):void e.emit("commit")})},n.prototype.subscribe=function(t,e){function n(){i._options=t||{},i._filter=i._options.filter,i._socket.emit("subscribe",i._options),i.emit("subscribed"),i._subscribed=!0,i.sync(e)}"function"==typeof t&&(e=t,t={});var i=this;return this._subscribed?this.unsubscribe(n):n(),this},n.prototype.unsubscribe=function(t){return t&&this._socket.once("unsubscribe",t),this.models.splice(0,this.models.length),this._socket.emit("unsubscribe"),this.emit("unsubscribed"),this._subscribed=!1,this},n.prototype.sync=function(t){this.load();var e=this.models.filter(function(t){return!t.meta.synced}).map(function(t){return t.get()});return t&&this.once("receipt:sync",t),this._socket.emit("sync",e),this},n.prototype.post=n.prototype.create=function(t,e){var n=new this._Model(this,t);return e&&n.once("receipt:post",e),n.post(),this},n.prototype.put=function(t,e,n){var i=this.find(t);return i&&(n&&i.once("receipt:put",n),i.put(e)),this},n.prototype["delete"]=function(t,e){var n=this.find(t);return n&&(e&&n.once("receipt:delete",e),n["delete"]()),this},n.prototype.clear=function(t){return t&&this._socket.once("receipt:clear",t),this._socket.emit("clear"),this},n.prototype.listen=function(t,e){return e&&this.once("receipt:listen:"+t,e),this._socket.emit("listen",t),this},n.prototype.unlisten=function(t,e){return e&&this.once("receipt:unlisten:"+t,e),this._socket.emit("unlisten",t),this},n.prototype.broadcast=function(t,e,n){return n&&this.once("receipt:broadcast",n),this._socket.emit("broadcast",{channel:t,payload:e}),this},n.prototype.close=function(t){return t&&this._socket.once("close",t),this._socket.close("close"),this},n.prototype.find=function(t){return this.models.filter(function(e){return e.id==t}).pop()},n.prototype.where=function(t){return new s(this,t)},e.exports=n}(this)},{"../modules/Model":2,"../modules/Query":3,"../storage":7,"../utils":13,"socket.io-client":1}],5:[function(t,e,n){arguments[4][2][0].apply(n,arguments)},{"../utils":13,dup:2}],6:[function(t,e,n){arguments[4][3][0].apply(n,arguments)},{"../utils":13,dup:3}],7:[function(t,e,n){!function(){function n(t,e){var n=this;this.options=e,this.booted=!1,this.driver=new u[e.driver](t,e),this.driver.boot(function(t){if(t)throw t;n.booted=!0})}var i=t("./localWrapperFactory"),o=t("./memory"),r=t("./jjlc"),s="undefined"!=typeof s?s:t("node-localstorage"),u={jjlc:i(r),memory:i(o),localStorage:i(s)};n.prototype.get=function(t){t=t||function(){},this.driver.get(t)},n.prototype.set=function(t,e){e=e||function(){},this.driver.set(t,e)},n.prototype.where=function(t,e){e=e||function(){},this.driver.where(t,e)},n.prototype.clear=function(t){t=t||function(){},this.driver.clear(t)},e.exports=n}(this)},{"./jjlc":8,"./localWrapperFactory":9,"./memory":10,"node-localstorage":1}],8:[function(t,e,n){!function(){function n(t){var e,n=[],i={};for(e in t)n.push([e,t[e]]);n.sort(function(t,e){return e[1]-t[1]});for(e in n)i[n[e][0]]=n[e][1];return i}function i(t){var e,n=t[t.length-1],o=t.substring(0,t.length-1);return"undefined"==typeof n?e="a":"z"===n?e="A":"Z"===n?(e="a",o=""!==o?i(o):"a"):e=String.fromCharCode(n.charCodeAt(0)+1),n=e,o+n}function o(t){var e,o,r={},s="",u=t.match(f);for(e in u)u[e].length>s.length+2&&("undefined"!=typeof r[u[e]]?r[u[e]]+=1:r[u[e]]=0);o=n(r);for(e in o)s=i(s),o[e]=p+s+p;return o}function r(t,e){var n,i;for(n in e)i=new RegExp(n,"g"),t=t.replace(i,e[n]);return t}function s(t,e){var n,i;for(n in e)i=new RegExp(e[n],"g"),t=t.replace(i,n);return t}function u(){this.setItem=function(t,e,n){var i,s,u;return"undefined"!=typeof n&&"no-beautify"===n||(s=JSON.parse(e),e=JSON.stringify(s)),u=o(e),i=r(e,u),"undefined"!=typeof n&&"local-dict"===n?d[t]=u:c.setItem(t,i),"undefined"==typeof d[t]&&c.setItem("d_"+t,JSON.stringify(u)),i},this.getItem=function(t){var e,n=c.getItem(t);return e="undefined"==typeof d[t]?JSON.parse(c.getItem("d_"+t)):d[t],s(n,e)},this.getDict=function(t){var e;return e="undefined"==typeof d[t]?JSON.parse(c.getItem("d_"+t)):d[t]},this.setDict=function(t,e,n){"undefined"==typeof n?c.setItem("d_"+t,e):d[t]=e}}var c="undefined"!=typeof c?c:t("node-localstorage"),f=/\"[a-zA-Z0-9]*\":/g,p="Â£",d={};e.exports=new u}(this)},{"node-localstorage":1}],9:[function(t,e,n){!function(){"use strict";function t(t){function e(e,n){this.storage=t,this.booted=!1,this.path=e,this.options=n}return e.prototype.boot=function(t){this.booted=!0,t&&t(null)},e.prototype.get=function(t){t=t||function(){};var e=this.storage.getItem(this.path);e||(e="[]"),e=JSON.parse(e),t(null,e)},e.prototype.set=function(t,e){e=e||function(){},t=JSON.stringify(t),this.storage.setItem(this.path,t),e(null)},e.prototype.where=function(t,e){e=e||function(){},this.get(function(n,i){return n?e(n):(i=utils.sift(t,i),void e(null,i))})},e.prototype.clear=function(t){t=t||function(){},this.set([],function(e){return e?t(e):void t(null)})},e}e.exports=t}(this)},{}],10:[function(t,e,n){!function(){var t={};e.exports={getItem:function(e){return t[e]||(t[e]=""),t[e]},setItem:function(e,n){t[e]=n}}}(this)},{}],11:[function(t,e,n){!function(){"use strict";function t(e,n){for(var i in n)n[i]&&n[i].constructor&&n[i].constructor===Object?(e[i]=e[i]||{},t(e[i],n[i])):e[i]=n[i];return e}e.exports=t}(this)},{}],12:[function(t,e,n){!function(){"use strict";function t(){this._events={}}t.prototype={on:function(t,e){var n=this;return t.split(/\s+/g).forEach(function(t){n._events[t]||(n._events[t]=[]),n._events[t].push(e)}),this},off:function(t,e){var n=this;return t.split(/\s+/g).forEach(function(t){var e=n._events[t];e&&(n._events[t]=n._events[t].filter(function(t){return t!==t}))}),this},once:function(t,e){var n=this;return t.split(/\s+/g).forEach(function(t){n._events[t]||(n._events[t]=[]),e._callOnce=!0,n._events[t].push(e)}),this},emit:function(t,e,n){var i=this;n=n||this;var o=this._events[t]||(this._events[t]=[]);return o.forEach(function(o){return o._callOnce?(delete o._callOnce,o.call(n,e),i.off(t,o),i):void o.call(n,e)}),this}},e.exports=t}(this)},{}],13:[function(t,e,n){!function(){"use strict";var n={};n.sift=t("./sift"),n.uuid=t("./uuid"),n.Eev=t("./eev"),n.deepExtend=t("./deepExtend"),e.exports=n}(this)},{"./deepExtend":11,"./eev":12,"./sift":14,"./uuid":15}],14:[function(t,e,n){!function(){"use strict";function t(t){return"function"==typeof t}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Date?t.getTime():t instanceof Array?t.map(i):t}function o(t,e){return t.get?t.get(e):t[e]}function r(t){return function(e,i){if(!n(i)||!i.length)return t(e,i);for(var r=0,s=i.length;s>r;r++)if(t(e,o(i,r)))return!0;return!1}}function s(t){return function(e,i){if(!n(i)||!i.length)return t(e,i);for(var r=0,s=i.length;s>r;r++)if(!t(e,o(i,r)))return!1;return!0}}function u(t,e){return t.v(t.a,e)}function c(t,e){for(var n=0;n<t.length;n++)if(u(e,o(t,n)))return n;return-1}function f(t,e){return{a:t,v:e}}function p(t,e){var n=[];return d(e,t.k,0,n),1===n.length?u(t.nv,n[0]):!!~c(n,t.nv)}function d(t,e,i,r){if(i===e.length||void 0==t)return void r.push(t);var s=o(e,i);if(n(t)&&isNaN(Number(s)))for(var u=0,c=t.length;c>u;u++)d(o(t,u),e,i,r);else d(o(t,s),e,i+1,r)}function a(t,e){return{a:{k:t,nv:e},v:p}}function h(t){t=i(t),(!t||"Object"!==t.constructor.toString()&&"functionObject(){[nativecode]}"!==t.constructor.toString().replace(/\n/g,"").replace(/ /g,""))&&(t={$eq:t});var e=[];for(var n in t){var o=t[n];if("$options"!==n)if(_[n])v[n]&&(o=v[n](o,t)),e.push(f(i(o),_[n]));else{if(36===n.charCodeAt(0))throw new Error("Unknown operation "+n);e.push(a(n.split("."),h(o)))}}return 1===e.length?e[0]:f(e,_.$and)}function l(t,e){var n=h(t);return e&&(n={a:n,v:function(t,n){return u(t,e(n))}}),n}function m(e,n,i){function o(t){return u(r,t)}t(n)&&(i=n,n=void 0);var r=l(e,i);return n?n.filter(o):o}var _={$eq:r(function(t,e){return t(e)}),$ne:s(function(t,e){return!t(e)}),$or:function(t,e){for(var n=0,i=t.length;i>n;n++)if(u(o(t,n),e))return!0;return!1},$gt:r(function(t,e){return m.compare(i(e),t)>0}),$gte:r(function(t,e){return m.compare(i(e),t)>=0}),$lt:r(function(t,e){return m.compare(i(e),t)<0}),$lte:r(function(t,e){return m.compare(i(e),t)<=0}),$mod:r(function(t,e){return e%t[0]==t[1]}),$in:function(t,e){if(!(e instanceof Array))return!!~t.indexOf(i(e));for(var n=e.length;n--;)if(~t.indexOf(i(o(e,n))))return!0;return!1},$nin:function(t,e){return!_.$in(t,e)},$not:function(t,e){return!u(t,e)},$type:function(t,e){return void 0!=e?e instanceof t||e.constructor==t:!1},$all:function(t,e){e||(e=[]);for(var n=t.length;n--;)if(!~i(e).indexOf(o(t,n)))return!1;return!0},$size:function(t,e){return e?t===e.length:!1},$nor:function(t,e){for(var n=0,i=t.length;i>n;n++)if(u(o(t,n),e))return!1;return!0},$and:function(t,e){for(var n=0,i=t.length;i>n;n++)if(!u(o(t,n),e))return!1;return!0},$regex:r(function(t,e){return"string"==typeof e&&t.test(e)}),$where:function(t,e){return t.call(e,e)},$elemMatch:function(t,e){return n(e)?!!~c(e,t):u(t,e)},$exists:function(t,e){return void 0!=e===t}},v={$eq:function(t){return t instanceof RegExp?function(e){return"string"==typeof e&&t.test(e)}:t instanceof Function?t:n(t)&&!t.length?function(t){return n(t)&&!t.length}:null===t?function(t){return null===t||void 0===t}:function(e){return 0===m.compare(i(e),t)}},$ne:function(t){return v.$eq(t)},$and:function(t){return t.map(h)},$or:function(t){return t.map(h)},$nor:function(t){return t.map(h)},$not:function(t){return h(t)},$regex:function(t,e){return new RegExp(t,e.$options)},$where:function(t){return t},$elemMatch:function(t){return h(t)},$exists:function(t){return!!t}};m.use=function(e){if(t(e))return e(m);for(var n in e)36===n.charCodeAt(0)&&(_[n]=e[n])},m.indexOf=function(t,e,n){return c(e,l(t,n))},m.compare=function(t,e){if(t===e)return 0;if(typeof t==typeof e){if(t>e)return 1;if(e>t)return-1}},e.exports=m}(this)},{}],15:[function(t,e,n){!function(){"use strict";function t(){for(var t="",e=1;36>=e;e++)t+=9===e||14===e||19===e||24===e?"-":15===e?4:20===e?n[4*Math.random()|8]:n[15*Math.random()|0];return t}for(var n=[],i=0;15>=i;i++)n[i]=i.toString(16);e.exports=t}(this)},{}],"castmydata-jsclient":[function(t,e,n){!function(){"use strict";var n=(t("./storage"),t("./utils")),i=t("./modules/model"),o=t("./modules/query"),r=t("./modules/endpoint"),s={Model:i,Query:o,Endpoint:r,Utils:n};e.exports=s}(this)},{"./modules/endpoint":4,"./modules/model":5,"./modules/query":6,"./storage":7,"./utils":13}]},{},[])("castmydata-jsclient")});