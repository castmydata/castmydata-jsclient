!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.CastMyData=t.CastMyData||{})}(this,function(t){"use strict";var e=function(){function t(t){this.head=new e,this.tail=new e(this.head),this.head.next=this.tail,this.linkConstructor=t,this.reg={}}function e(t,e,o){this.prev=t,this.next=e,this.fn=o||i}function i(){}function o(){this._events={}}var n=0;return t.prototype={insert:function(t){var i=new e(this.tail.prev,this.tail,t);return i.next.prev=i.prev.next=i,i},remove:function(t){t.prev.next=t.next,t.next.prev=t.prev}},e.prototype.run=function(t){this.fn(t),this.next&&this.next.run(t)},o.prototype={on:function(e,i){var o=this;e.split(/\W+/g).forEach(function(e){var s=o._events[e]||(o._events[e]=new t),r=i._eev||(i._eev=++n);s.reg[r]||(s.reg[r]=s.insert(i))})},off:function(t,e){var i=this;t.split(/\W+/g).forEach(function(t){var o=i._events[t],n=o.reg[e._eev];o.reg[e._eev]=void 0,o&&n&&o.remove(n)})},emit:function(t,e){var i=this._events[t];i&&i.head.run(e)}},o}(),i=function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)},o=function(t,e){var e=e||{},o=this;i(e,function(t,e){o[e]=t}),this._events={},this._endpoint=t};o.prototype=Object.create(e.prototype),o.prototype["delete"]=function(){this._endpoint["delete"](this.id)},o.prototype.put=function(t){var t=t||{},e=this;i(t,function(t,i){e[i]=t}),this._endpoint.put(this.id,t)};var n=function(t,e){var n="undefined"!=typeof io?io:require("socket.io-client"),s=this._socket=n(t,{multiplex:!1}),r=this.models=[],p=this;this._events={},s.path=e,s.on("records",function(t){r.splice(0,r.length);t.forEach(function(t){t=new o(p,t),t.emit("post",t),r.push(t)});p.emit("records",r)}),s.on("post",function(t){var e=new o(p,t.payload);r.push(e),p.emit("post",e)}),s.on("put",function(t){var e=r.filter(function(e){return e.id==t.id}).pop();e&&(i(t.payload,function(t,i){e[i]=t}),e.emit("put",t.payload),p.emit("put",e,t.payload))}),s.on("delete",function(t){var e=r.filter(function(e){return e.id==t.id}).pop(),i=r.indexOf(e);e&&(r.splice(i,1),e.emit("delete"),p.emit("delete",e))}),s.on("broadcast",function(t){p.emit("broadcast",t.payload)})};n.prototype=Object.create(e.prototype),n.prototype.subscribe=function(t){var t=t||{};return this._socket.options=t,this._socket.emit("join",{path:this._socket.path,options:t}),this},n.prototype.unsubscribe=function(){return this._socket.emit("leave",{path:this._socket.path}),this},n.prototype.all=function(t){return this._socket.emit("all",this._socket.path),this},n.prototype.find=function(t){return this.models.filter(function(e){return e.id==t}).pop()},n.prototype.post=function(t){return this._socket.emit("post",{path:this._socket.path,payload:t}),this},n.prototype.put=function(t,e){return this._socket.emit("put",{path:this._socket.path,payload:e,id:t}),this},n.prototype["delete"]=function(t){return this._socket.emit("delete",{path:this._socket.path,id:t}),this},n.prototype.broadcast=function(t){return this._socket.emit("broadcast",{path:this._socket.path,payload:t}),this},n.prototype.close=function(){this._socket.close()},t.Model=o,t.Endpoint=n});